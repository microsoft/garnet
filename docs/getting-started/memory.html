<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/memory" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Managing memory usage of Garnet | Garnet</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://microsoft.github.io/garnet/docs/getting-started/memory"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Managing memory usage of Garnet | Garnet"><meta data-rh="true" name="description" content="For large-scale production scenarios, Garnet&#x27;s memory usage needs to be tuned to make optimal use"><meta data-rh="true" property="og:description" content="For large-scale production scenarios, Garnet&#x27;s memory usage needs to be tuned to make optimal use"><link data-rh="true" rel="icon" href="/garnet/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://microsoft.github.io/garnet/docs/getting-started/memory"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/garnet/docs/getting-started/memory" hreflang="en"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/garnet/docs/getting-started/memory" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Memory","item":"https://microsoft.github.io/garnet/docs/getting-started/memory"}]}</script><link rel="alternate" type="application/rss+xml" href="/garnet/blog/rss.xml" title="Garnet RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/garnet/blog/atom.xml" title="Garnet Atom Feed">




<script>!function(t,e,n,c,a,r,s){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(r=e.createElement(c)).async=1,r.src="https://www.clarity.ms/tag/loh6v65ww5",(s=e.getElementsByTagName(c)[0]).parentNode.insertBefore(r,s)}(window,document,"clarity","script")</script><link rel="stylesheet" href="/garnet/assets/css/styles.a0a59612.css">
<script src="/garnet/assets/js/runtime~main.b11d0a9e.js" defer="defer"></script>
<script src="/garnet/assets/js/main.88e0605f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/garnet/img/garnet-logo-diamond.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/garnet/"><div class="navbar__logo"><img src="/garnet/img/garnet-logo-diamond.png" alt="Garnet Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/garnet/img/garnet-logo-diamond.png" alt="Garnet Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Garnet</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/garnet/docs">Docs</a><a class="navbar__item navbar__link" href="/garnet/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/microsoft/garnet" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/garnet/docs"><span title="Welcome" class="categoryLinkLabel_W154">Welcome</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs"><span title="Intro" class="linkLabel_WmDU">Intro</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/welcome/news"><span title="News" class="linkLabel_WmDU">News</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/welcome/features"><span title="Features" class="linkLabel_WmDU">Features</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/welcome/releases"><span title="Releases" class="linkLabel_WmDU">Releases</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/welcome/compatibility"><span title="Compatibility" class="linkLabel_WmDU">Compatibility</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/welcome/roadmap"><span title="Roadmap" class="linkLabel_WmDU">Roadmap</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/welcome/faq"><span title="FAQ" class="linkLabel_WmDU">FAQ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/welcome/about-us"><span title="About Us" class="linkLabel_WmDU">About Us</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/garnet/docs/getting-started"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/getting-started"><span title="Build" class="linkLabel_WmDU">Build</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/getting-started/configuration"><span title="Configuration" class="linkLabel_WmDU">Configuration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/garnet/docs/getting-started/memory"><span title="Memory" class="linkLabel_WmDU">Memory</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/security"><span title="Security" class="linkLabel_WmDU">Security</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/garnet/docs/getting-started/compaction"><span title="Compaction" class="linkLabel_WmDU">Compaction</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/garnet/docs/benchmarking/overview"><span title="Benchmarking" class="categoryLinkLabel_W154">Benchmarking</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/garnet/docs/commands/overview"><span title="Commands" class="categoryLinkLabel_W154">Commands</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/garnet/docs/extensions/overview"><span title="Server Extensions" class="categoryLinkLabel_W154">Server Extensions</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/garnet/docs/cluster/overview"><span title="Cluster Mode" class="categoryLinkLabel_W154">Cluster Mode</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/garnet/docs/dev/onboarding"><span title="Developer Guide" class="categoryLinkLabel_W154">Developer Guide</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/garnet/docs/azure/overview"><span title="Managed Offering (Azure)" class="categoryLinkLabel_W154">Managed Offering (Azure)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/garnet/docs/research/papers"><span title="Research" class="categoryLinkLabel_W154">Research</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a href="https://github.com/microsoft/garnet/releases" target="_blank" rel="noopener noreferrer" class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false"><span title="Other Links" class="categoryLinkLabel_W154">Other Links</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/garnet/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Memory</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Memory Usage</h1></header>
<p>For large-scale production scenarios, Garnet&#x27;s memory usage needs to be tuned to make optimal use
of available memory on a machine. Here, we discuss the components of memory, and how to tune them.
Configuration parameters are listed <a class="" href="/garnet/docs/getting-started/configuration">here</a>.</p>
<p>Garnet is designed as two storage instances of Tsavorite: the main store and the object store. Each one is independently configured for memory. If you use only raw strings (e.g., <code>GET</code>, <code>SET</code> and their variants), <code>HYPERLOGLOG</code>, and <code>BITMAP</code> commands, you should disable the object store using the <code>DisableObjects</code> (<code>--no-obj</code>) parameter. This will avoid wasting memory for the object store.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="main-store">Main Store<a href="#main-store" class="hash-link" aria-label="Direct link to Main Store" title="Direct link to Main Store" translate="no">​</a></h2>
<p>Memory used by the main store consists of the sum of three components:</p>
<ul>
<li class="">Index size</li>
<li class="">Log size</li>
<li class="">Overflow buckets</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="index-size">Index Size<a href="#index-size" class="hash-link" aria-label="Direct link to Index Size" title="Direct link to Index Size" translate="no">​</a></h3>
<p>The index size is configured using the <code>IndexSize</code> (<code>-i</code> or <code>--index</code>) parameter. It specifies the total size in bytes
that the index occupies in main memory. The index is organized as hash buckets, where each bucket is 64 bytes long, i.e.,
the size of a cache line. The bucket holds 7 entries and a pointer to an overflow bucket, described <a href="#overflow-buckets" class="">below</a>.</p>
<p>The rule of thumb for sizing the index is: if you expect the cache-store to hold K keys, set the size to <code>K * 16</code> bytes. The
reasoning for this is:</p>
<ul>
<li class="">We want buckets to be half full on average, so around 4 keys per bucket</li>
<li class="">Therefore, with K keys, we want <code>K / 4</code> buckets</li>
<li class="">Each bucket takes up 64 bytes</li>
<li class="">So, the total size is <code>64 * (K / 4) = K * 16</code> bytes</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="log-size">Log Size<a href="#log-size" class="hash-link" aria-label="Direct link to Log Size" title="Direct link to Log Size" translate="no">​</a></h3>
<p>The index described above does not hold keys or values. Instead, both keys and values are stored in a separate structure
called the hybrid log. The memory occupied by the log is configured using <code>MemorySize</code> (<code>-m</code> or <code>--memory</code>).</p>
<p>Memory is organized as a circular buffer of pages, where each page has size configured using <code>PageSize</code> (<code>-p</code> or <code>--page</code>). The page
size controls the maximum key or value size you can store, as a record needs to fit entirely within a page.</p>
<p>A record in the Garnet main store consists of:</p>
<ul>
<li class="">An 8-byte header, called <code>RecordInfo</code>, which holds metadata and the logical address of the previous entry in a record chain.</li>
<li class="">The key, which consists of an 8-byte header followed by the key bytes (<code>SpanByte</code>)</li>
<li class="">The value, which consists of an 8-byte header followed by the value bytes (<code>SpanByte</code>)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="overflow-buckets">Overflow buckets<a href="#overflow-buckets" class="hash-link" aria-label="Direct link to Overflow buckets" title="Direct link to Overflow buckets" translate="no">​</a></h3>
<p>Each hash bucket has 7 entries (slots) that store the root of a chain of records stored in the log. If the hash bucket for
a given key is full, we overflow into extra buckets called overflow buckets that are allocated dynamically. While these
cannot be controlled or bounded, they are typically very small and can be ignored. In case your index was sized too small,
they can take up more space, and to combat this, you can dynamically grow the index as described <a href="#auto-resizing-index" class="">below</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="auto-resizing-index">Auto-Resizing Index<a href="#auto-resizing-index" class="hash-link" aria-label="Direct link to Auto-Resizing Index" title="Direct link to Auto-Resizing Index" translate="no">​</a></h3>
<p>You can configure Garnet to automatically grow the index (doubling each time) as it fills up. This is done by
configuring <code>IndexResizeFrequencySecs</code> (<code>--index-resize-freq</code>) to specify how frequently to trigger the
resizing check. Index growth is triggered if the number of overflow buckets exceeds a specified percentage
of the total number of main hash buckets. This threshold is specified using <code>IndexResizeThreshold</code> (<code>--index-resize-threshold</code>).</p>
<p>We also support <code>IndexMaxSize</code> (<code>--index-max-size</code>) which identifies the maximum size until which the index
will grow in size. We do not support index size shrinking at this point.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="object-store">Object Store<a href="#object-store" class="hash-link" aria-label="Direct link to Object Store" title="Direct link to Object Store" translate="no">​</a></h2>
<p>The index and overflow buckets are managed similarly to the main store, and the corresponding parameters
are:</p>
<ul>
<li class=""><code>ObjectStoreIndexSize</code> (<code>--obj-index</code>)</li>
<li class=""><code>ObjectStoreIndexMaxSize</code> (<code>--obj-index-max-size</code>)</li>
</ul>
<p>However, the log memory is handled differently, as described below.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="log-size-object-store">Log Size (Object Store)<a href="#log-size-object-store" class="hash-link" aria-label="Direct link to Log Size (Object Store)" title="Direct link to Log Size (Object Store)" translate="no">​</a></h3>
<p>In case of the object store, the hybrid log holds <em>references</em> to keys and values (which are objects), rather
than the actual keys and values themselves. The memory occupied by the object store log is configured using
<code>ObjectStoreLogMemorySize</code> (<code>--obj-log-memory</code>). However, this parameter only controls the number of records
in the object store, where each record consists of:</p>
<ul>
<li class="">An 8-byte header, called <code>RecordInfo</code>, which holds metadata and the logical address of the previous entry in a record chain.</li>
<li class="">An 8-byte reference to the key object, which is a byte array on heap (byte[])</li>
<li class="">An 8-byte reference to the value object, which is an <code>IGarnetObject</code> instance, which could be different object types such as SortedSet, Hash, Set, etc.</li>
</ul>
<p>In other words, when you set <code>ObjectStoreLogMemorySize</code>, you are only controlling the number of records in
memory, and not the total memory usage of the objects. Specifically, since each record is 24 bytes long,
setting <code>ObjectStoreLogMemorySize</code> to S merely implies that you can hold at most <code>S / 24</code> records in main
memory.</p>
<p>This means, of course, that we need to track the total memory using a different mechanism. For this, Garnet
exposes a configuration called <code>ObjectStoreHeapMemorySize</code> (<code>--obj-heap-memory</code>) which represents the heap memory
used by key byte arrays and the <code>IGarnetObject</code> instances in bytes. You can use this parameter in combination with the <code>--obj-log-memory</code>
to control the total memory used by the object store.</p>
<p>To summarize, the total space occupied by the object store is the sum of:</p>
<ul>
<li class="">Object store index size (and overflow buckets), as before</li>
<li class=""><code>ObjectStoreLogMemorySize</code> (<code>--obj-log-memory</code>) which controls the maximum <em>number</em> of records in memory.</li>
<li class=""><code>ObjectStoreHeapMemorySize</code> (<code>--obj-heap-memory</code>) which controls the total heap size occupied by the objects.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="read-cache">Read Cache<a href="#read-cache" class="hash-link" aria-label="Direct link to Read Cache" title="Direct link to Read Cache" translate="no">​</a></h2>
<p>Read cache helps bring in records from disk to memory in a separate read cache region without growing the main log. This helps avoid additional I/O when reading records that are already on the disk. More details on the internals of read cache are available <a class="" href="/garnet/docs/dev/tsavorite/locking#readcache">here</a>.</p>
<p>Read cache can be independently enabled for either the main store or the object store or both of them simultaneously.
Use the <code>--readcache</code> option to enable it for the main store and the <code>--obj-readcache</code> option for the object store.</p>
<p>Following configuration options can be used to control the memory utilization of the read cache:</p>
<ul>
<li class=""><code>--readcache-page</code> helps controls the size of each page for the main store read cache.</li>
<li class=""><code>--readcache-memory</code> controls the total size of the main store read cache.</li>
<li class=""><code>--obj-readcache-page</code> specifies the size of each page for the object store read cache.</li>
<li class=""><code>--obj-readcache-log-memory</code> controls the total size of the object store read cache log memory size which is the way to control the maximum number of records in memory.</li>
<li class=""><code>--obj-readcache-heap-memory</code> controls the total heap size occupied by the objects in read cache.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/microsoft/garnet/tree/main/website/docs/getting-started/memory.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/garnet/docs/getting-started/configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configuration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/garnet/docs/security"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Security</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#main-store" class="table-of-contents__link toc-highlight">Main Store</a><ul><li><a href="#index-size" class="table-of-contents__link toc-highlight">Index Size</a></li><li><a href="#log-size" class="table-of-contents__link toc-highlight">Log Size</a></li><li><a href="#overflow-buckets" class="table-of-contents__link toc-highlight">Overflow buckets</a></li><li><a href="#auto-resizing-index" class="table-of-contents__link toc-highlight">Auto-Resizing Index</a></li></ul></li><li><a href="#object-store" class="table-of-contents__link toc-highlight">Object Store</a><ul><li><a href="#log-size-object-store" class="table-of-contents__link toc-highlight">Log Size (Object Store)</a></li></ul></li><li><a href="#read-cache" class="table-of-contents__link toc-highlight">Read Cache</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/garnet/docs/getting-started">Getting Started</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://aka.ms/garnet-discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/msrgarnet" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/garnet/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/microsoft/garnet" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><p class="text-center">
          <a href="https://go.microsoft.com/fwlink/?LinkId=521839" style="color: white;">Privacy &amp; Cookies</a> |
          <a href="https://go.microsoft.com/fwlink/?LinkID=2259814" style="color: white;">Consumer Health Privacy</a> |
          <a href="https://go.microsoft.com/fwlink/?LinkID=206977" style="color: white;">Terms of Use</a> |
          <a href="https://www.microsoft.com/trademarks" style="color: white;">Trademarks</a> | © 2025
          </p></div></div></div></footer></div>
</body>
</html>