"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[6559],{1706(e,i,r){r.r(i),r.d(i,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"azure/resiliency","title":"Resiliency in Azure Cosmos DB Garnet Cache","description":"Azure Cosmos DB Garnet Cache is designed for high availability and resilience, providing enterprise-grade uptime, data persistence, and automatic recovery capabilities. The service offers multiple layers of protection to ensure your cache remains available and your data is preserved even during infrastructure failures, maintenance events, or unexpected outages.","source":"@site/docs/azure/resiliency.md","sourceDirName":"azure","slug":"/azure/resiliency","permalink":"/garnet/docs/azure/resiliency","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/garnet/tree/main/website/docs/azure/resiliency.md","tags":[],"version":"current","frontMatter":{"id":"resiliency","sidebar_label":"Resiliency","title":"Resiliency in Azure Cosmos DB Garnet Cache"},"sidebar":"garnetDocSidebar","previous":{"title":"Cluster Configuration","permalink":"/garnet/docs/azure/cluster-configuration"},"next":{"title":"Security","permalink":"/garnet/docs/azure/security"}}');var t=r(74848),a=r(28453);const s={id:"resiliency",sidebar_label:"Resiliency",title:"Resiliency in Azure Cosmos DB Garnet Cache"},o="Resiliency in Azure Cosmos DB Garnet Cache",l={},c=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Data Distribution and Sharding",id:"data-distribution-and-sharding",level:3},{value:"High Availability",id:"high-availability",level:2},{value:"Replication",id:"replication",level:3},{value:"Automatic Failovers",id:"automatic-failovers",level:3},{value:"Multi Availability Zone Deployment",id:"multi-availability-zone-deployment",level:3},{value:"Data Persistence",id:"data-persistence",level:2},{value:"Learn More",id:"learn-more",level:2}];function d(e){const i={a:"a",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"resiliency-in-azure-cosmos-db-garnet-cache",children:"Resiliency in Azure Cosmos DB Garnet Cache"})}),"\n",(0,t.jsx)(i.p,{children:"Azure Cosmos DB Garnet Cache is designed for high availability and resilience, providing enterprise-grade uptime, data persistence, and automatic recovery capabilities. The service offers multiple layers of protection to ensure your cache remains available and your data is preserved even during infrastructure failures, maintenance events, or unexpected outages."}),"\n",(0,t.jsx)(i.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,t.jsx)(i.p,{children:"Azure Cosmos DB Garnet Cache implements a distributed architecture with built-in redundancy and data persistence, deployed in a single Azure region."}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Primary-Replica Architecture"}),": Each cache cluster consists of one or more shards with primary node and replica nodes"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Asynchronous Replication"}),": Data is asynchronously replicated from primaries"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"AOF Persistence"}),": Append-Only File snapshots provide durable data storage to disk"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Automatic Failover"}),": Fast failover for minimal service interruption"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Automatic Recovery"}),": Failed nodes recover using AOF snapshots and replication"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"Architecture",src:r(57666).A+"",width:"1246",height:"718"})}),"\n",(0,t.jsx)(i.h3,{id:"data-distribution-and-sharding",children:"Data Distribution and Sharding"}),"\n",(0,t.jsx)(i.p,{children:"Azure Cosmos DB Garnet Cache uses a consistent hashing approach to distribute data across the cluster for optimal availability and load distribution. The cluster's key space is divided into 16,384 hash slots, with each slot owned by a single primary node. Any given key maps to exactly one slot, ensuring predictable data placement and efficient retrieval."}),"\n",(0,t.jsx)(i.p,{children:"When you have multiple shards in your cluster, hash slots are evenly distributed across all primary nodes. This distribution ensures that data and load are balanced across the cluster, preventing hotspots and maximizing resource utilization. Replica nodes serve read-only requests for the keys hashing to slots owned by their corresponding primary nodes, enabling read scaling while maintaining data consistency."}),"\n",(0,t.jsx)(i.p,{children:"This sharding strategy provides several resiliency benefits: if a primary node fails, only the keys in its assigned slots are affected, while the rest of the cluster continues operating normally. Automatic slot reassignment ensures that when nodes become unavailable, their hash slots can be redistributed to healthy nodes, maintaining cluster availability even during node failures."}),"\n",(0,t.jsx)(i.h2,{id:"high-availability",children:"High Availability"}),"\n",(0,t.jsx)(i.h3,{id:"replication",children:"Replication"}),"\n",(0,t.jsx)(i.p,{children:"Azure Cosmos DB Garnet Cache supports configurable replication factors to balance availability requirements with cost. You can configure replication during cluster provisioning and it can't be changed on existing clusters."}),"\n",(0,t.jsxs)(i.table,{children:[(0,t.jsx)(i.thead,{children:(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.th,{children:"Configuration"}),(0,t.jsx)(i.th,{children:"Replication Factor"}),(0,t.jsx)(i.th,{children:"Total Nodes Per Shard"}),(0,t.jsx)(i.th,{children:"Use Cases"})]})}),(0,t.jsxs)(i.tbody,{children:[(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"No Replication"})}),(0,t.jsx)(i.td,{children:"1x"}),(0,t.jsx)(i.td,{children:"1, primary only"}),(0,t.jsx)(i.td,{children:"Development, testing, cost-optimized production"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"High Availability"})}),(0,t.jsx)(i.td,{children:"2x"}),(0,t.jsx)(i.td,{children:"2, one replica per primary"}),(0,t.jsx)(i.td,{children:"Mission-critical applications"})]}),(0,t.jsxs)(i.tr,{children:[(0,t.jsx)(i.td,{children:(0,t.jsx)(i.strong,{children:"Optimized Read Performance"})}),(0,t.jsx)(i.td,{children:"3x-5x*"}),(0,t.jsx)(i.td,{children:"3-5, two to four replicas per primary"}),(0,t.jsx)(i.td,{children:"Mission-critical applications requiring high read throughput"})]})]})]}),"\n",(0,t.jsxs)(i.p,{children:["*Reach out to ",(0,t.jsx)(i.a,{href:"mailto:ManagedGarnet@service.microsoft.com",children:"ManagedGarnet@service.microsoft.com"})," if you need a higher replication factor."]}),"\n",(0,t.jsx)(i.p,{children:"The replication process is as follows"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Write Operations"}),": All writes go to the primary node first"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Asynchronous Replication"}),": The write is acknowledged once written in the primary and is asynchronously replicated to all replicas in the shard"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Consistency"}),": Eventual consistency between replicas"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Read Distribution"}),": Read operations can be distributed across primary and replica nodes"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"automatic-failovers",children:"Automatic Failovers"}),"\n",(0,t.jsx)(i.p,{children:"A failover can be either planned, such as system updates or management operations, or it can be unplanned, such as hardware failure or unexpected outages. The Azure Cosmos DB Garnet Cache automatically handles failovers for you and will promote a replica to primary after detecting one of these events."}),"\n",(0,t.jsx)(i.h3,{id:"multi-availability-zone-deployment",children:"Multi Availability Zone Deployment"}),"\n",(0,t.jsxs)(i.p,{children:["Azure Cosmos DB Garnet Cache can be configured with availability zones during provisioning in ",(0,t.jsx)(i.a,{href:"/garnet/docs/azure/cluster-configuration#regional-availability",children:"supported Azure regions"})," where there is capacity for your chosen SKU. See the list of ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/azure/reliability/regions-list",children:"Azure regions with availability zone support"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"If enabled, nodes are automatically distributed across multiple availability zones within the region. Primary and replica nodes are not guaranteed to be in different availability zones. If a zone goes down and all replicas for a given shard are unhealthy, the hash slots assigned to it will automatically be reassigned to healthy shards."}),"\n",(0,t.jsx)(i.h2,{id:"data-persistence",children:"Data Persistence"}),"\n",(0,t.jsxs)(i.p,{children:["Azure Cosmos DB Garnet Cache uses append only file (AOF) persistence to ensure data durability. Every write operation is appended to a persistent log file stored on an attached locally redundant ",(0,t.jsx)(i.a,{href:"https://learn.microsoft.com/azure/virtual-machines/disks-types#premium-ssds",children:"Premium Managed Disk"}),". Checkpoints are stored every second. The disk size is automatically provisioned for each node based on 2x the total amount of memory for the SKU. See the ",(0,t.jsx)(i.a,{href:"/garnet/docs/azure/cluster-configuration#available-tiers",children:"disks provisioned for each SKU"}),"."]}),"\n",(0,t.jsx)(i.p,{children:"Data on nodes is restored from the latest data checkpoint upon restart, including from automatic failovers. It is possible to experience data loss after a failover for the portion of data that hasn't been replicated or wasn't included in the latest checkpoint."}),"\n",(0,t.jsx)(i.h2,{id:"learn-more",children:"Learn More"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"/garnet/docs/azure/quickstart",children:"Getting Started"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"/garnet/docs/azure/cluster-configuration",children:"Cluster Configuration"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"/garnet/docs/azure/security",children:"Security"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"/garnet/docs/azure/monitoring",children:"Monitoring"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,a.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},57666(e,i,r){r.d(i,{A:()=>n});const n=r.p+"assets/images/architecture-d45868afbb8812b02dda80ef8fb30928.png"},28453(e,i,r){r.d(i,{R:()=>s,x:()=>o});var n=r(96540);const t={},a=n.createContext(t);function s(e){const i=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),n.createElement(a.Provider,{value:i},e.children)}}}]);