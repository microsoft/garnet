"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5140],{11385:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>m,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"dev/custom-commands","title":"Garnet Custom Commands","description":"Overview","source":"@site/docs/dev/custom-commands.md","sourceDirName":"dev","slug":"/dev/custom-commands","permalink":"/garnet/docs/dev/custom-commands","draft":false,"unlisted":false,"editUrl":"https://github.com/microsoft/garnet/tree/main/website/docs/dev/custom-commands.md","tags":[],"version":"current","frontMatter":{"id":"custom-commands","sidebar_label":"Custom Commands","title":"Garnet Custom Commands"},"sidebar":"garnetDocSidebar","previous":{"title":"Transactions","permalink":"/garnet/docs/dev/transactions"},"next":{"title":"Logical Databases","permalink":"/garnet/docs/dev/multi-db"}}');var r=s(74848),i=s(28453);const t={id:"custom-commands",sidebar_label:"Custom Commands",title:"Garnet Custom Commands"},a=void 0,c={},d=[{value:"Overview",id:"overview",level:2},{value:"Supported Custom Command Types",id:"supported-custom-command-types",level:2},{value:"Server-Side Command Registration",id:"server-side-command-registration",level:2},{value:"Client-Side Command Registration",id:"client-side-command-registration",level:2},{value:"Enabling Client-Side Command Registration",id:"enabling-client-side-command-registration",level:3},{value:"REGISTERCS Command",id:"registercs-command",level:3},{value:"Full command syntax:",id:"full-command-syntax",level:4},{value:"New command sub-command syntax:",id:"new-command-sub-command-syntax",level:4},{value:"RESP Reply",id:"resp-reply",level:3},{value:"REGISTERCS Errors",id:"registercs-errors",level:3}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Garnet supports registering custom commands and transactions implemented in C#, both programmatically on the server-side and through running dedicated REGISTERCS command in the client-side."}),"\n",(0,r.jsx)(n.h2,{id:"supported-custom-command-types",children:"Supported Custom Command Types"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Raw String Commands"}),": To implement a custom raw string command, implement a class that inherits from the ",(0,r.jsx)(n.code,{children:"CustomRawStringFunctions"})," base class (See example: ",(0,r.jsx)(n.code,{children:"main\\GarnetServer\\Extensions\\DeleteIfMatch.cs"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Object Commands"}),": To implement a custom object command, implement your custom object class that inherits from ",(0,r.jsx)(n.code,{children:"GarnetObjectBase"})," base class, as well as a factory that creates your object type that inherits from the ",(0,r.jsx)(n.code,{children:"CustomObjectFactory"})," base class (See example: ",(0,r.jsx)(n.code,{children:"main\\GarnetServer\\Extensions\\MyDictObject.cs"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Transaction"}),": To implement a custom transaction, implement a class that inherits from the ",(0,r.jsx)(n.code,{children:"CustomTransactionProcedure"})," base class (See example: ",(0,r.jsx)(n.code,{children:"main\\GarnetServer\\Extensions\\ReadWriteTxn.cs"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Procedure"}),": To implement a non-transactional procedure, implement a class that inherits from the ",(0,r.jsx)(n.code,{children:"CustomProcedure "})," base class (See example: ",(0,r.jsx)(n.code,{children:"main\\GarnetServer\\Extensions\\Sum.cs"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"server-side-command-registration",children:"Server-Side Command Registration"}),"\n",(0,r.jsxs)(n.p,{children:["To register a new custom command from the server-side, use the GarnetServer instance's RegisterApi, and call either ",(0,r.jsx)(n.code,{children:"NewCommand"})," or ",(0,r.jsx)(n.code,{children:"NewTransactionProc"})," according to the custom command type that you are trying to register."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Raw String Commands"}),": To register a new command using a concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomRawStringFunctions"}),", call ",(0,r.jsx)(n.code,{children:"RegisterApi.NewCommand(string name, int numParams, CommandType type, CustomRawStringFunctions customFunctions, RespCommandsInfo commandInfo = null, long expirationTicks = 0)"}),", where ",(0,r.jsx)(n.code,{children:"customFunctions"})," is an instance of the new concrete class."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Object Commands"}),": To register a new command using a concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomObjectFactory"}),", call ",(0,r.jsx)(n.code,{children:"RegisterApi.NewCommand(string name, int numParams, CommandType commandType, CustomObjectFactory factory, RespCommandsInfo commandInfo = null)"}),", where ",(0,r.jsx)(n.code,{children:"factory"})," is an instance of the new concrete class."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Transaction"}),": To register a new transaction using a concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomTransactionProcedure"}),", call ",(0,r.jsx)(n.code,{children:"NewTransactionProc(string name, int numParams, Func<CustomTransactionProcedure> proc, RespCommandsInfo commandInfo = null)"}),", where ",(0,r.jsx)(n.code,{children:"proc"})," is a ",(0,r.jsx)(n.code,{children:"Func"})," that returns an instance of the new concrete class."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Procedure"}),": To register a new procedure using a concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomProcedure"}),", call ",(0,r.jsx)(n.code,{children:"RegisterApi.NewProcedure(string name, CustomProcedure customProcedure, RespCommandsInfo commandInfo = null, RespCommandDocs commandDocs = null)"}),", where ",(0,r.jsx)(n.code,{children:"customProcedure"})," is an instance of the procedure concrete class."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Note that each call to the RegisterApi has an optional ",(0,r.jsx)(n.code,{children:"RespCommandsInfo commandInfo"})," parameter. This parameter allows you to supply Garnet with metadata regarding the custom command that will be visible to the client when running the ",(0,r.jsx)(n.a,{href:"/garnet/docs/commands/server#command",children:(0,r.jsx)(n.code,{children:"COMMAND"})})," or ",(0,r.jsx)(n.a,{href:"/garnet/docs/commands/server#command-info",children:(0,r.jsx)(n.code,{children:"COMMAND INFO"})})," commands."]}),"\n",(0,r.jsx)(n.h2,{id:"client-side-command-registration",children:"Client-Side Command Registration"}),"\n",(0,r.jsxs)(n.p,{children:["To register a new custom command from the client-side, use the dedicated REGISTERCS command in the client app (",(0,r.jsx)(n.strong,{children:"note:"})," this is an ",(0,r.jsx)(n.strong,{children:"admin command"}),"). ",(0,r.jsx)("br",{}),"\nThe REGISTERCS command takes assemblies that exist on the server and contain implementations for either of the supported custom command classes, and registers the custom commands on the server according to parameters given by the client ",(0,r.jsx)("br",{}),"\nThe REGISTERCS command supports registering multiple commands and / or transactions from multiple files and / or directories containing C# binary files (*.dll / *.exe).",(0,r.jsx)("br",{})]}),"\n",(0,r.jsx)(n.h3,{id:"enabling-client-side-command-registration",children:"Enabling Client-Side Command Registration"}),"\n",(0,r.jsxs)(n.p,{children:["To enable registering client-side custom commands, you must specify a list of allowed paths from which assemblies can potentially be loaded, and enable module commands.\nThis is done by setting the configuration parameters ",(0,r.jsx)(n.code,{children:"EnableModuleCommand"})," and ",(0,r.jsx)(n.code,{children:"ExtensionBinPaths"}),".\nExample (in garnet.config):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"EnableModuleCommand": "local",\n"ExtensionBinPaths": ".\\first\\path\\,..\\..\\second\\path\\"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note #1"}),": Assemblies can be loaded from any directory level under these specified paths",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.strong,{children:"Note #2"}),": By default, Garnet only allows loading of digitally signed assemblies. To remove that requirement (not recommended), set the configuration parameter ",(0,r.jsx)(n.code,{children:"ExtensionAllowOnlySignedAssemblies"})," to ",(0,r.jsx)(n.code,{children:"false"}),".",(0,r.jsx)("br",{})]}),"\n",(0,r.jsx)(n.h3,{id:"registercs-command",children:"REGISTERCS Command"}),"\n",(0,r.jsxs)(n.p,{children:["To run the REGISTERCS command, run the REGISTERCS keyword followed by one or more new command subcommands, followed by the optional INFO keyword which is followed by a path pointing to a JSON file containing a serialized array of ",(0,r.jsx)(n.code,{children:"RespCommandsInfo"})," objects, containing command metadata (*.json), followed by the SRC keyword, which is followed by one or more paths to C# binary files or directories containing C# binary files (*.dll / *.exe).",(0,r.jsx)("br",{})]}),"\n",(0,r.jsx)(n.h4,{id:"full-command-syntax",children:"Full command syntax:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"REGISTERCS cmdType name numParams className [expTicks] [cmdType name numParams className [expTicks] ...] [INFO path] SRC path [path ...]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each new command that you intend to register, is specified by either of the command type keywords, followed by its parameters."}),"\n",(0,r.jsx)(n.h4,{id:"new-command-sub-command-syntax",children:"New command sub-command syntax:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cmdType name numParams cmdType className [expTicks]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Command Type:"}),(0,r.jsx)("br",{}),"\nThe following keywords are legal values for ",(0,r.jsx)(n.code,{children:"cmdType"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"READ"})," (New read command)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"READMODIFYWRITE"})," or ",(0,r.jsx)(n.strong,{children:"RMW"})," (New Read-modify-write command)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TRANSACTION"})," or ",(0,r.jsx)(n.strong,{children:"TXN"})," (New transaction)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"name"}),": Name of the new command"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"numParams"}),": Number of parameters taken by the new command"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"className"}),": Class name of concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomRawStringFunctions"})," or ",(0,r.jsx)(n.code,{children:"CustomObjectFactory"})," for new ",(0,r.jsx)(n.strong,{children:"READ"})," / ",(0,r.jsx)(n.strong,{children:"RMW"})," commands, or ",(0,r.jsx)(n.code,{children:"CustomTransactionProcedure"})," for new ",(0,r.jsx)(n.strong,{children:"TXN"})," commands (must exist in assemblies referenced in paths list)",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"expTicks"}),": Command expiry in ticks (only relevant for custom raw string commands, ignored otherwise)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"-1"}),": remove existing expiration metadata;"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"0"}),": retain whatever it is currently (or no expiration if this is a new entry) - this is the default;"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:">0"}),": => set expiration to given value."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," If the server could not register one or more of the commands / transactions specified, or if it could not load or enumerate one or more of the files or directories specified in the REGISTERCS command, no action will be taken (i.e. no command will be registered), and the command execution will fail with an appropriate error message."]}),"\n",(0,r.jsx)(n.h3,{id:"resp-reply",children:"RESP Reply"}),"\n",(0,r.jsx)(n.p,{children:"Returns +OK on success, otherwise --ERR message if any"}),"\n",(0,r.jsx)(n.h3,{id:"registercs-errors",children:"REGISTERCS Errors"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR malformed REGISTERCS command"})," - Error in the parsing of the REGISTERCS command"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to access command info file."})," - Error accessing command info file specified after the INFO keyword"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR command info file is not contained in allowed paths."})," - Command info file specific is not contained in the allowed path list according to the server configuration (",(0,r.jsx)(n.code,{children:"ExtensionBinPaths"})," in garnet.config)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR malformed command info JSON."})," - Error deserializing command info JSON file"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to access one or more binary files"})," - Error accessing or enumerating one or more files or folders specified in path list"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR one or more binary file are not contained in allowed paths"})," - One or more of the binary paths specified are not contained in the allowed path list according to the server configuration (",(0,r.jsx)(n.code,{children:"ExtensionBinPaths"})," in garnet.config)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to load one or more assemblies"})," - Error loading one or more assemblies from binary files retrieved from path list (assembly load is attempted on all *.dll / *.exe files specified or found in directories specified)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR one or more assemblies loaded is not digitally signed"})," - One or more of the loaded assemblies are not digitally signed. This error will occur when trying to load unsigned assemblies when the server configuration is set to allow loading of only digitally signed assemblies (",(0,r.jsx)(n.code,{children:"ExtensionAllowOnlySignedAssemblies"})," in garnet.conf)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to instantiate one or more classes from given assemblies"})," - Error creating an instance of one or more classes specified using loaded assemblies (note that each class should have an empty constructor)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to register one or more unsupported classes"})," - Error registering one or more unsupported classes, i.e. one or more of the classes were not implementing one of the expected base classes"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var o=s(96540);const r={},i=o.createContext(r);function t(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);