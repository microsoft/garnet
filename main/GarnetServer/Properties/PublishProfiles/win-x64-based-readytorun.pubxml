<?xml version="1.0" encoding="utf-8"?>
<!--
https://go.microsoft.com/fwlink/?LinkID=208121.
-->
<Project>
  <PropertyGroup>
    <Configuration>Release</Configuration>
    <Platform>Any CPU</Platform>
    <PublishDir>bin\Release\net8.0\publish\win-x64\</PublishDir>
    <PublishProtocol>FileSystem</PublishProtocol>
    <_TargetId>Folder</_TargetId>
    <TargetFramework>net8.0</TargetFramework>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>
    <SelfContained>false</SelfContained>
    <PublishSingleFile>true</PublishSingleFile>
    <PublishReadyToRun>true</PublishReadyToRun>
  </PropertyGroup>
  <ItemGroup>
      <ProjectReference Include="..\..\hosting\Windows\Garnet.worker\Garnet.worker.csproj" />
  </ItemGroup>
  <Target Name="CopyWorkerDll" AfterTargets="Publish">
	  <ItemGroup>
		  <WorkerFiles Include="..\..\hosting\Windows\Garnet.worker\bin\$(Configuration)\net8.0\Garnet.Worker.*" />
		  <DependantDLLFiles Include="..\..\hosting\Windows\Garnet.worker\bin\$(Configuration)\net8.0\*.dll" />
		  <DependantXMLFiles Include="..\..\hosting\Windows\Garnet.worker\bin\$(Configuration)\net8.0\*.xml" />
		  <RuntimeFilesWinx64 Include="..\..\hosting\Windows\Garnet.worker\bin\$(Configuration)\net8.0\runtimes\win-x64\native\*" />
		  <RuntimeFilesWin Include="..\..\hosting\Windows\Garnet.worker\bin\$(Configuration)\net8.0\runtimes\win\lib\net8.0\*" />
	  </ItemGroup>
	  <Copy SourceFiles="@(WorkerFiles)" DestinationFolder="$(PublishDir)Service" />
	  <Copy SourceFiles="@(DependantDLLFiles)" DestinationFolder="$(PublishDir)Service" />
	  <Copy SourceFiles="@(DependantXMLFiles)" DestinationFolder="$(PublishDir)Service" />
	  <Copy SourceFiles="@(RuntimeFilesWinx64)" DestinationFolder="$(PublishDir)Service\runtimes\win-x64\native" />
	  <Copy SourceFiles="@(RuntimeFilesWin)" DestinationFolder="$(PublishDir)Service\runtimes\win\lib\net8.0" />
  </Target>
  <Target Name="DeleteWorkerFiles" AfterTargets="CopyWorkerDll">
	  <Delete Files="$(PublishDir)Garnet.worker.exe" />
	  <Delete Files="$(PublishDir)Garnet.worker.deps.json" />
	  <Delete Files="$(PublishDir)Garnet.worker.runtimeconfig.json" />
  </Target>
</Project>